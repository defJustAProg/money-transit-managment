# Веб-сервис для управления движением денежных средств (ДДС)

Система для учета, управления и анализа поступлений и списаний денежных средств с удобным веб-интерфейсом.

## Возможности

- ✅ Создание, редактирование, удаление и просмотр записей о движении денежных средств
- ✅ Фильтрация транзакций по дате, статусу, типу, категории и подкатегории
- ✅ Управление справочниками (статусы, типы операций, категории)
- ✅ Древовидная структура категорий с подкатегориями
- ✅ Валидация логических зависимостей между сущностями
- ✅ REST API для интеграции с внешними системами
- ✅ Адаптивный веб-интерфейс на Bootstrap

## Технологии

- **Backend**: Django 5.0, Django REST Framework
- **База данных**: SQLite (по умолчанию), PostgreSQL (для продакшена)
- **Frontend**: Django Templates, Bootstrap 5, jQuery
- **Древовидные структуры**: django-mptt
- **Документация API**: drf-spectacular (Swagger/OpenAPI)

## Структура проекта

```
money-transit-managment/
├── project/                 # Настройки Django
│   ├── django/
│   │   ├── settings.py     # Основные настройки
│   │   └── urls.py         # Главные URL маршруты
│   └── settings/           # Дополнительные настройки
├── transit_managment/      # Основное приложение
│   ├── models.py          # Модели данных
│   ├── serializers.py     # DRF сериализаторы
│   ├── views.py           # Views и ViewSets
│   ├── urls.py            # URL маршруты приложения
│   └── management/        # Django команды
├── templates/             # HTML шаблоны
│   ├── base.html         # Базовый шаблон
│   └── transit_managment/ # Шаблоны приложения
├── manage.py             # Django управляющий скрипт
├── pyproject.toml        # Зависимости проекта
└── docker-compose.yaml   # Docker конфигурация
```

## Модели данных

### Status (Статус)
- Бизнес, Личное, Налог
- Расширяемый список

### TransactionType (Тип операции)
- Пополнение, Списание
- Расширяемый список

### Category (Категория)
- Древовидная структура с MPTT
- Привязка к типу операции
- Поддержка подкатегорий

### Transaction (Транзакция)
- Дата операции
- Статус, тип, категория
- Сумма в рублях
- Комментарий (необязательный)

## Установка и запуск

### Локальная разработка

1. **Клонирование репозитория**
   ```bash
   git clone <repository-url>
   cd money-transit-managment
   ```

2. **Установка зависимостей**
   ```bash
   # Используя uv (рекомендуется)
   uv sync
   
   # Или используя pip
   pip install -r requirements.txt
   ```

3. **Настройка базы данных**
   ```bash
   # Создание миграций
   uv run python manage.py makemigrations
   
   # Применение миграций
   uv run python manage.py migrate
   
   # Загрузка начальных данных
   uv run python manage.py load_initial_data
   ```

4. **Создание суперпользователя (опционально)**
   ```bash
   uv run python manage.py createsuperuser
   ```

5. **Запуск сервера разработки**
   ```bash
   uv run python manage.py runserver
   ```

6. **Открытие в браузере**
   - Главная страница: http://127.0.0.1:8000/
   - Админ-панель: http://127.0.0.1:8000/backend/admin/
   - API документация: http://127.0.0.1:8000/backend/swagger/

### Docker (продакшен)

1. **Создание .env файла**
   ```bash
   cp .env.example .env
   # Отредактируйте переменные окружения
   ```

2. **Запуск с Docker Compose**
   ```bash
   docker-compose up -d
   ```

3. **Применение миграций и загрузка данных**
   ```bash
   docker-compose exec webserver python manage.py migrate
   docker-compose exec webserver python manage.py load_initial_data
   docker-compose exec webserver python manage.py createsuperuser
   ```

## Использование

### Веб-интерфейс

1. **Главная страница** - просмотр всех транзакций с фильтрацией
2. **Добавление транзакции** - форма создания новой записи
3. **Редактирование** - изменение существующих транзакций
4. **Управление справочниками** - добавление/редактирование статусов, типов и категорий

### API Endpoints

- `GET /backend/api/statuses/` - список статусов
- `GET /backend/api/transaction-types/` - список типов операций
- `GET /backend/api/categories/` - список категорий
- `GET /backend/api/categories/tree/` - дерево категорий
- `GET /backend/api/transactions/` - список транзакций
- `POST /backend/api/transactions/` - создание транзакции
- `GET /backend/api/transactions/stats/` - статистика по транзакциям

### Фильтрация транзакций

API поддерживает следующие параметры фильтрации:
- `date_from` - дата начала периода
- `date_to` - дата окончания периода
- `status` - ID статуса
- `transaction_type` - ID типа операции
- `category` - ID категории

Пример: `/backend/api/transactions/?date_from=2025-01-01&status=1`

## Бизнес-правила

1. **Логические зависимости**:
   - Подкатегории привязаны к категориям
   - Категории привязаны к типам операций
   - Нельзя выбрать подкатегорию без выбора родительской категории

2. **Валидация**:
   - Поля "сумма", "тип", "категория" обязательны
   - Сумма должна быть больше 0
   - Категория должна соответствовать выбранному типу операции
   - Можно выбирать только конечные категории (листья дерева)

## Разработка

### Добавление новых полей

1. Измените модель в `models.py`
2. Обновите сериализатор в `serializers.py`
3. Создайте миграцию: `python manage.py makemigrations`
4. Примените миграцию: `python manage.py migrate`

### Добавление новых API endpoints

1. Добавьте ViewSet в `views.py`
2. Зарегистрируйте в `urls.py`
3. Обновите документацию

### Кастомизация интерфейса

Шаблоны находятся в папке `templates/`. Используйте Bootstrap классы для стилизации.

## Лицензия

MIT License

## Поддержка

Для вопросов и предложений создавайте Issues в репозитории проекта.
